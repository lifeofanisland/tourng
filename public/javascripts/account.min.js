var obj;
//validate email
function validateEmail(email) {
    var re = /^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(email);
}
function validate_signup(){
    //prevent form from submitting
    event.preventDefault();
    //reset fields border to normal
    $('.signupfd').css('border-color','#cccccc');
    //get data from form fields
    var agencytype = $('select[name=agencytype]').val();
    var agencytitle = $('input[name=agencytitle]').val();
    var agencyname = $('input[name=agencyname]').val();
    var agencyemail = $('input[name=agencyemail]').val();
    var agencypassword = $('input[name=agencypassword]').val();
    var agencyphone = $('input[name=agencyphone]').val();
    var agencyaddress = $('textarea[name=agencyaddress]').val();
    var agencyabout = $('textarea[name=agencyabout]').val();
    var facebook = $('input[name=facebook]').val();
    //validate form fields
    if(!agencytype){
        $('select[name=agencytype]').css('border-color','red');
        showusererror("Agency type is required");
    }else if (!agencytitle){
        $('input[name=agencytitle]').css('border-color','red');
        showusererror("Agency name is required");
    }else if (!agencyname){
        $('input[name=agencyname]').css('border-color','red');
        showusererror("Contact person is required");
    }else if (!agencyemail){
        $('input[name=agencyemail]').css('border-color','red');
        showusererror("Email address is required");
    }else if (!validateEmail(agencyemail)){
        $('input[name=agencyemail]').css('border-color','red');
        showusererror("Please use a proper email address");
    }else if (!agencypassword){
        $('input[name=agencypassword]').css('border-color','red');
        showusererror("Password is required");
    }else if (!agencyphone){
        $('input[name=agencyphone]').css('border-color','red');
        showusererror("Telephone is required");
    }else if (!agencyaddress){
        $('textarea[name=agencyaddress]').css('border-color','red');
        showusererror("Agency address is required");
    }else if (!agencyabout) {
        $('textarea[name=agencyabout]').css('border-color', 'red');
        showusererror("Agency description is required");
    }else if (!facebook) {
        $('input[name=facebook]').css('border-color', 'red');
        showusererror("Facebook Link is required");
    }else if(facebook.indexOf('https://www.facebook.com/') == -1){
        showusererror("Please a proper facebook link, e.g https://www.facebook.com/Safetee");
    }else {
        document.getElementById('signupform').submit();
    }
}
function validate_signin(){
    //prevent form from submitting
    event.preventDefault();
    //reset fields border to normal
    $('.signinfd').css('border-color','#cccccc');
    //get data from form fields
    var loginemail = $('input[name=loginemail]').val();
    var loginpassword = $('input[name=loginpassword]').val();
    //validate form fields
    if (!loginemail){
        $('input[name=loginemail]').css('border-color','red');
        showusererror("Email address is required");
    }else if (!validateEmail(loginemail)){
        $('input[name=agencyemail]').css('border-color','red');
        showusererror("Please use a proper email address");
    }else if (!loginpassword){
        $('input[name=loginpassword]').css('border-color','red');
        showusererror("Password is required");
    }else {
        document.getElementById('signinform').submit();
    }
}
function validate_post(){
    event.preventDefault();
    var title = $('input[name=posttitle]').val();
    var body= $('textarea[name=postbody]').val();
    //validate form fields
    if (!title){
        showusererror("Article title is required");
    }else if (!body){
        showusererror("Article body is required");
    }else {
        document.getElementById('postform').submit();
    }
}
//explore pages
function explorepages(a) {
    $('#'+a+'ac').css('color','#f65314');
    $('.pages').css('display', 'none');
    $('#' + a).css('display', 'block');
    $('#activesort').html(a);
    $('.pagesa').css('display', 'block');
    $('#' + a + 'a').css('display', 'none');
   showuserinfo("<img src='/images/loading.gif' width='15px;'>&nbsp; Please wait...");
    var data = {};
    data.rtype = a;
    $.ajax({type: 'POST',url:'/agency/dashboard',data: JSON.stringify(data), contentType: 'application/json', success: function(response){
        $('#userinfo').css('display','none');
    }
    });
}
//show user error
function showusererror(a){
    $('#userinfo').css('background','rgba(0,0,0,0.8)');
    $('#userinfo').css('position','fixed');
    $('#userinfo').css('padding','20px');
    $('#userinfo').css('color','white');
    $('#userinfo').css('font-size','15px');
    $('#userinfo').css('border-radius','5px');
    $('#userinfo').fadeIn(3000);
    $('#userinfo').fadeOut(3000);
    $('#userinfo').html(a);
}
//show user error
function showuserinfo(a){
    $('#userinfo').css('background','rgba(0,0,0,0.8)');
    $('#userinfo').css('position','fixed');
    $('#userinfo').css('padding','20px');
    $('#userinfo').css('color','white');
    $('#userinfo').css('font-size','15px');
    $('#userinfo').css('border-radius','5px');
    $('#userinfo').css('z-index','100000px');
    $('#userinfo').fadeIn(3000);
    //$('#userinfo').fadeOut(3000);
    $('#userinfo').html(a);
}
//report media div
function reportsdiv(a){
    $('#rdplay').modal();
}

//take up case
function takecase(cid) {
    var gotakecase = takeleavecase(cid,'takecase');
    $('#rd'+a).find('#takecase').html("Case taken");
    $('#rd'+a).find('#takecaseicon').css('color','#f65314');
    $('#rd'+a).find('#takecaseiconf').css('color','#f65314');
}
//take up case
function leavecase(cid) {
    var goleavecase = takeleavecase(cid,'leavecase');
    $('#rd'+a).find('#leavecase').html("Case dropped");
    $('#rd'+a).find('#takecaseicon').css('color','#2d89ef');
    $('#rd'+a).find('#takecaseiconf').css('color','#2d89ef');
    $('#userinteraction').css('display','block');
    $('#userinteraction').find('.popup').html('<div style="margin-top:10%;"><center><span class="fa fa-check" style="font-size:90px;"></span></center></div>');
    $('#userinteraction').fadeOut(3000);
}
//leave or take case
function takeleavecase(b,c){
    var data = {};
    data.caseid = b;
    data.type = c;
    $('#case1'+b).html("<img src='/images/loading.gif' width='15px;'>");
    $.ajax({
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json',
        url: '/agency/takeleavecase',
        success: function(response) {
            obj = JSON.parse(response);

            if(c == "takecase"){
                $('#case1'+b).html('<span onclick="leavecase(\''+b+'\');" class="fa fa-bookmark pointercursor orange" data-toggle="tooltip" href="#" alt="Leave Case" title="Leave Case"></span> <sup style="font-size:13px" class="fa fa-check-circle"></sup>');
                $('#joincase').modal();
                $('#joincase').find('#victim').html(obj[0].sender);
            }else if(c == "leavecase"){
                $('#case1'+b).html('<span onclick="takecase(\''+b+'\');" class="fa fa-bookmark pointercursor" data-toggle="tooltip" href="#" alt="Join Case" title="Join Case"></span> <sup style="font-size:13px" class="fa fa-plus-circle"></sup>');
            }
            return data;
        }
    });
}
//function get record play
function getrecord(a,b){
    $('.streamctrl2').css('display','none');
    $('#openrecord').modal();
    $('#openrecord').find('#heading').html(a);
    $('#openrecord').find('#innercontent').html("<center><img src='/images/loading.gif' width='30px;'></center><br/>");
    var data = {};
    data.caseid = b;
    $.ajax({type: 'POST',url:'/agency/record',data: JSON.stringify(data), contentType: 'application/json', success: function(response) {
        $('#openrecord').find('#innercontent').html(response);
        //return true;
    }
    });
}
//function to change report fontawesome icons
function changereporticon(a,b) {
    if(b == "a") {
        $('#rep1' + a).html(' <span class="fa fa-play-circle"></span>');
    }
    if(b == "b") {
        $('#rep1' + a).html(' <span class="fa fa-inbox"></span>');
    }
}
//function to sort records
function sortrecord(a) {
    $('#activesort').html(a);
    $('#activesort').prepend("<img src='/images/loading.gif' width='15px;'>&nbsp;");
    var data = {};
    data.rtype = a;
    $.ajax({type: 'POST',url:'/agency/dashboard',data: JSON.stringify(data), contentType: 'application/json', success: function(response) {
        //$('#activesort').html(a);
        window.location='/agency/dashboard';
    }
    });

}
//new post
function newpost() {
    $('#newpost').modal();
}
//function to delete post
function deletepost(a) {
    showuserinfo("<img src='/images/loading.gif' width='15px'>&nbsp; Deleting Post...");
    var data = {};
    data.id = a;
    data.action = 'delete';
    $.ajax({type: 'POST',url:'/agency/dashboard',data: JSON.stringify(data), contentType: 'application/json', success: function(response) {
        showuserinfo("<span class='fa fa-check-circle-o'></span> Post Deleted");
        $('#post'+a).hide();
        $('#userinfo').fadeOut(3000);
    }
    });

}
//function get edit post
function geteditpost(a){
    showuserinfo("<img src='/images/loading.gif' width='15px'>&nbsp; Please wait...");
    var data = {};
    data.id = a;
    $.ajax({
        type: 'POST',
        url:'/agency/singlepost',
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: function(response) {
            $('#userinfo').fadeOut(400);
            obj = JSON.parse(response);
            var title = obj.article[0].title;
            var body = obj.article[0].body;
            var tag = obj.article[0].tag;
            editpost(a,title,body,tag);
        //return true;
    }
    });
}
//function edit post
function editpost(a,b,c,d){
    if(b !== 'undefined') {
        $('input[name=posttitle]').val(b);
    }
    if(c !== 'undefined') {
        $('#jqte_editor').val(c);
    }
    if(d !== 'undefined') {
        $('input[name=posttags]').val(d);
    }
    $('#newpost').modal();
    $('#newpost').find('#heading').html(b);
}
//add youtube
function addyoutube() {
    var youtube = $("#youtubeurl").val();
    if(youtube == "") {
        showuserinfo("Youtube video link is empty");
        $('#userinfo').fadeOut(3000);
    }else if(youtube.indexOf("https://www.youtube.com/watch?v=") == -1){
        showuserinfo("Please use a proper youtube video link");
        $('#userinfo').fadeOut(3000);
    }else{
        youtube = youtube.replace("https://www.youtube.com/watch?v=","");
        $('.jqte_editor').append("<div style='margin-top:20px;margin-bottom:30px;'><iframe src='https://www.youtube.com/embed/"+youtube+"' width='100%' height='350px' frameborder='0' r></iframe></div><div style='margin-top:50px;color:white;'>......</div><p>Continue Editing.....</p>");
        document.getElementById("useyoutube").style.display = 'none';
    }
}
//open popup
function popup(a){
    document.getElementById(a).style.display = 'block';
}
//close popup
function closepopup(a){
    document.getElementById(a).style.display = 'none';
}